<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sorrend</title>
    <style>
        /* --- Alapvet≈ë St√≠lusok --- */
        body {
            font-family: 'Times New Roman', Georgia, serif;
            margin: 0;
            padding: 0;
            background-color: #f0f4f7;
            color: #333333;
            /* Mobilon megakad√°lyozza a v√©letlen kijel√∂l√©st */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #0E163D;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-row {
            display: -webkit-box;      /* R√©gi iOS */
            display: -ms-flexbox;      /* R√©gi IE */
            display: flex;
            -webkit-box-pack: justify;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            margin-bottom: 20px;
        }

        /* Gap helyett margin hack a kompatibilit√°s√©rt */
        .header-row > * { margin: 0 5px; }

        .logo-left { max-height: 80px; width: auto; }
        .logo-right { max-height: 140px; width: auto; }

        .header-text { 
            text-align: center; 
            -webkit-box-flex: 1; 
            -ms-flex-positive: 1; 
            flex-grow: 1; 
        }

        .candidate-label {
            font-size: 1.4rem;
            color: #ffffff;
            margin-bottom: 5px;
            font-family: Georgia, serif;
        }

        .candidate-name {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.2;
        }

        p { line-height: 1.5; margin-bottom: 15px; color: #ffffff;}
        
        /* --- F√°jl felt√∂lt√©s szekci√≥ --- */
        .file-upload-section {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border: 1px dashed #6c757d;
            text-align: center;
        }
        .file-upload-section label {
            font-weight: bold;
            color: #495057;
            cursor: pointer;
            display: block;
            padding: 10px;
            /* Nagyobb √©rint√©si fel√ºlet */
            font-size: 1.1em;
        }
        #file-error-msg {
            color: #dc3545;
            font-size: 0.9em;
            display: none;
            margin-top: 5px;
        }
        
        /* --- K√©toszlopos elrendez√©s --- */
        .ranking-wrapper {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            /* Gap helyett margin a gyerekeken */
            align-items: flex-start;
            margin-bottom: 20px;
        }

        #number-column {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
            width: 40px; 
            padding-top: 0; 
            flex-shrink: 0;
            margin-right: 10px; /* Gap p√≥tl√°sa */
        }

        .number-item {
            height: auto; 
            min-height: 50px; /* Kicsit kisebb, hogy biztosan elf√©rjen */
            margin-bottom: 8px; /* Hozz√°tartoz√≥ sentence-item marginj√°hoz igaz√≠tva */
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            color: #ffffff; 
            font-weight: bold;
            font-size: 1.4em; 
            width: 100%;
            /* Igaz√≠t√°s a dobozok k√∂zep√©hez vizu√°lisan */
            padding-top: 10px; 
        }

        #sentence-list {
            list-style: none;
            padding: 0;
            margin: 0;
            -webkit-box-flex: 1;
            -ms-flex-positive: 1;
            flex-grow: 1;
            min-height: 50px;
            position: relative; /* Fontos a pozicion√°l√°shoz */
        }

        .sentence-item {
            background-color: #88E8FF; 
            margin-bottom: 8px; /* Elemk√∂z√∂k */
            padding: 15px 15px 15px 40px; /* Bal padding a "foganty√∫" hely√©nek */
            border-left: 5px solid #3282F6; 
            cursor: move; /* Kurzor jelzi a mozgathat√≥s√°got */
            cursor: -webkit-grab;
            border-radius: 4px;
            font-size: 1.05em;
            position: relative;
            min-height: 24px; 
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            touch-action: none; /* Fontos: letiltja a g√∂rget√©st az elemen */
        }

        /* Ikon a mozgat√°shoz (vizu√°lis seg√≠ts√©g) */
        .sentence-item::before {
            content: '‚ò∞';
            position: absolute;
            left: 10px;
            color: #0056b3;
            font-size: 1.2em;
            font-weight: bold;
        }

        .sentence-item.dragging {
            opacity: 0.8;
            background-color: #A3FFFD;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 100;
            transform: scale(1.02);
        }

        .button-group {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            margin-top: 25px;
        }
        
        .button-group button {
            -webkit-box-flex: 1;
            -ms-flex-positive: 1;
            flex-grow: 1;
            padding: 15px 10px; /* Nagyobb gombok √©rint√©shez */
            border: 2px solid #ffffff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin: 0 5px; /* Gap p√≥tl√°sa */
        }
        
        .confirm-btn { background-color: #24B574; color: white; }
        .stats-btn { background-color: #0E163D; color: white; }

        .save-btn {
            background-color: #0056b3;
            color: white;
            padding: 12px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 15px;
            width: 100%;
            font-size: 1em;
        }

        #result-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            background-color: #d4edda;
            color: #155724;
            display: none;
        }
        
        #counter-display {
            margin-top: 20px;
            padding: 10px;
            text-align: center;
			color: #ffffff;
            border: 1px solid #0E163D;
            border-radius: 4px;
            font-size: 1.1em;
            background-color: #0E163D;
        }
        
        #counter-value { font-weight: bold; color: #ffffff; font-size: 1.5em; }

        /* --- Mod√°lis ablak --- */
        #statistics-modal {
            position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); display: none;
        }
        .modal-content {
            background-color: #ffffff; margin: 5% auto; padding: 20px;
            border-radius: 8px; width: 90%; max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); max-height: 80vh; overflow-y: auto;
        }
        .close-btn { color: #aaa; float: right; font-size: 30px; font-weight: bold; cursor: pointer; padding: 0 10px; }
        
        .score-item {
            background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404;
            padding: 10px; margin-bottom: 5px; border-radius: 4px;
            display: -webkit-box; display: -ms-flexbox; display: flex;
            -webkit-box-pack: justify; -ms-flex-pack: justify; justify-content: space-between;
        }

        @media (max-width: 650px) {
            .container { margin: 10px auto; padding: 15px; }
            .button-group { display: block; }
            .button-group button { width: 100%; margin: 5px 0; }
            .header-row { display: block; text-align: center; }
            .header-row > * { margin: 10px 0; }
            .logo-left { max-height: 60px; }
            .logo-right { max-height: 100px; }
            #number-column { width: 30px; margin-right: 5px; }
            .number-item { font-size: 1.2em; padding-top: 15px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-row">
        <img alt="Logo" src="Logo.png" class="logo-left">
        <div class="header-text">
            <div class="candidate-label">A Mi jel√∂lt√ºnk</div>
            <div class="candidate-name">Szeleczky Annam√°ria</div>
        </div>
        <img alt="Candidate" src="Candidate.png" class="logo-right">
    </div>

    <div id="upload-container" class="file-upload-section">
        <label for="options-file">üìÇ Ha nem t√∂lt≈ëd√∂tt be mag√°t√≥l, kattints ide az <b>Options.txt</b> bet√∂lt√©s√©hez!</label>
        <input type="file" id="options-file" accept=".txt" style="display: none;">
        <div id="file-error-msg"></div>
    </div>

    <p>√Åll√≠tsa az al√°bbi probl√©m√°kat fontoss√°gi sorrendbe (legfel√ºl a legfontosabb). Fogja meg √©s h√∫zza √°t az elemeket!</p>

    <div class="ranking-wrapper">
        <div id="number-column">
            <div class="number-item">1.</div>
        </div>

        <ul id="sentence-list">
            <li class="sentence-item">K√©rlek t√∂ltsd be az Options.txt f√°jlt a fenti gombbal!</li>
        </ul>
    </div>

    <div class="button-group">
        <button class="confirm-btn" onclick="confirmOrder()">Sorrend nyugt√°z√°sa</button>
        <button class="stats-btn" onclick="showStatistics()">Statisztika megtekint√©se</button>
    </div>

    <div id="result-message"></div>
    
    <div id="counter-display">
        Nyugt√°z√°sok sz√°ma: <span id="counter-value">0</span>
    </div>
</div>

<div id="statistics-modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2>üìä √ñsszes√≠tett statisztika</h2>
        
        <button class="save-btn" onclick="saveStatisticsToFile()">üíæ Statisztika ment√©se f√°jlba</button>

        <p>Eddig elv√©gzett nyugt√°z√°sok: <span id="modal-counter-value">0</span></p>
        
        <div id="score-ranking-container"></div>
        <hr>
        <div id="statistics-results">
            <ul class="stats-list" style="list-style: none; padding: 0;"></ul>
        </div>
    </div>
</div>

<script>
    // --- V√°ltoz√≥k inicializ√°l√°sa (var haszn√°lata a r√©gi b√∂ng√©sz≈ëk miatt) ---
    var sentenceList = document.getElementById('sentence-list');
    var numberColumn = document.getElementById('number-column');
    var resultMessage = document.getElementById('result-message');
    var counterValue = document.getElementById('counter-value');
    var statisticsModal = document.getElementById('statistics-modal');
    var modalCounterValue = document.getElementById('modal-counter-value');
    var statisticsResults = document.getElementById('statistics-results');
    var scoreRankingContainer = document.getElementById('score-ranking-container');
    var fileInput = document.getElementById('options-file');
    var fileErrorMsg = document.getElementById('file-error-msg');
    var uploadContainer = document.getElementById('upload-container'); 
    
    var confirmationCount = 0;
    var preferenceStats = [];
    
    // Drag & Drop v√°ltoz√≥k
    var dragSrcEl = null;
    
    // --- 1. OPCI√ìK BET√ñLT√âSE (XMLHttpRequest a fetch helyett) ---

    window.onload = function() {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'Options.txt', true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200 || xhr.status === 0) { // status 0 a helyi f√°jlokhoz
                    var text = xhr.responseText;
                    if (text && text.length > 0) {
                        fileErrorMsg.style.display = 'none';
                        processOptions(text);
                    }
                } else {
                    console.log("Automata bet√∂lt√©s hiba.");
                    fileErrorMsg.textContent = "Kattints a fenti gombra az Options.txt bet√∂lt√©s√©hez!";
                    fileErrorMsg.style.display = 'block';
                }
            }
        };
        try { xhr.send(); } catch(e) { 
            console.log(e); 
            fileErrorMsg.textContent = "Kattints a fenti gombra az Options.txt bet√∂lt√©s√©hez!";
            fileErrorMsg.style.display = 'block';
        }
    };

    fileInput.addEventListener('change', function(e) {
        var file = e.target.files[0];
        if (!file) return;

        var reader = new FileReader();
        reader.onload = function(e) {
            processOptions(e.target.result);
            fileErrorMsg.style.display = 'none'; 
        };
        reader.readAsText(file, "UTF-8"); 
    });

    function processOptions(text) {
        // Sort√∂r√©sek kezel√©se (IE kompatibilis split)
        var lines = text.replace(/\r\n/g, "\n").split("\n");
        var cleanLines = [];
        for(var k=0; k<lines.length; k++) {
            if(lines[k].trim() !== "") cleanLines.push(lines[k]);
        }
        cleanLines = cleanLines.slice(0, 5); // Csak az els≈ë 5

        if (cleanLines.length === 0) {
            alert("A f√°jl √ºres vagy nem olvashat√≥!");
            return;
        }

        // Lista t√∂rl√©se
        sentenceList.innerHTML = '';
        for(var i=0; i<cleanLines.length; i++) {
            var li = document.createElement('li');
            li.className = 'sentence-item';
            // Nem haszn√°lunk HTML5 draggable-t, mert rossz tableten.
            // Saj√°t esem√©nyeket haszn√°lunk al√°bb.
            li.textContent = cleanLines[i].trim();
            sentenceList.appendChild(li);
        }

        // Sz√°mok oszlopa
        numberColumn.innerHTML = '';
        for(var j = 1; j <= cleanLines.length; j++) {
            var numDiv = document.createElement('div');
            numDiv.className = 'number-item';
            numDiv.textContent = j + ".";
            numberColumn.appendChild(numDiv);
        }

        initializeStats(cleanLines.length);
        addDragEvents(); // Egyedi drag logika aktiv√°l√°sa

        if (uploadContainer) {
            uploadContainer.style.display = 'none';
        }
    }

    function initializeStats(count) {
        preferenceStats = [];
        for (var i = 0; i < count; i++) {
            preferenceStats.push({});
        }
    }

    // --- 2. UNIVERZ√ÅLIS DRAG & DROP (Eg√©r + √ârint√©s) ---
    // Ez a r√©sz helyettes√≠ti a modern API-t, hogy m≈±k√∂dj√∂n r√©gi tableten is.
    
    function addDragEvents() {
        var items = document.querySelectorAll('.sentence-item');
        for (var i = 0; i < items.length; i++) {
            var item = items[i];
            
            // Eg√©r esem√©nyek
            item.addEventListener('mousedown', handleStart, false);
            
            // √ârint≈ëk√©perny≈ë esem√©nyek
            item.addEventListener('touchstart', handleStart, false);
            item.addEventListener('touchmove', handleMove, { passive: false });
            item.addEventListener('touchend', handleEnd, false);
        }
    }

    // Glob√°lis v√°ltoz√≥k a mozgat√°shoz
    var activeItem = null;
    var startY = 0;
    var startX = 0;

    function handleStart(e) {
        // Ha nem bal gomb (eg√©rn√©l), kil√©p√©s
        if (e.type === 'mousedown' && e.button !== 0) return;

        activeItem = this; // Az elem, amire r√°kattintottunk
        activeItem.classList.add('dragging');
        
        // Koordin√°t√°k ment√©se
        if (e.type === 'touchstart') {
            var touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
        } 
        
        // Eg√©r esem√©nyek feliratkoz√°sa glob√°lisan, hogy k√∂vethess√ºk a mozg√°st
        if (e.type === 'mousedown') {
            document.addEventListener('mousemove', handleMouseMove, false);
            document.addEventListener('mouseup', handleEnd, false);
        }
    }

    // Csak eg√©r mozgat√°sa
    function handleMouseMove(e) {
        e.preventDefault();
        checkSwap(e.clientX, e.clientY);
    }

    // Csak √©rint√©s mozgat√°sa
    function handleMove(e) {
        if (!activeItem) return;
        
        // Megakad√°lyozzuk a g√∂rget√©st, am√≠g h√∫zzuk az elemet!
        if (e.cancelable) e.preventDefault(); 

        var touch = e.touches[0];
        checkSwap(touch.clientX, touch.clientY);
    }

    // A logika, ami eld√∂nti, kell-e cser√©lni k√©t elemet
    function checkSwap(x, y) {
        if (!activeItem) return;

        // Megn√©zz√ºk, mi van az ujjunk alatt
        // A r√©gi tabletek miatt tr√ºkk√∂zni kell: elrejtj√ºk a h√∫zott elemet egy pillanatra,
        // hogy "al√°l√°ssunk", mi van alatta.
        var originalDisplay = activeItem.style.display;
        activeItem.style.display = 'none'; 
        
        var elementBelow = document.elementFromPoint(x, y);
        
        activeItem.style.display = originalDisplay; // Visszahozzuk

        if (!elementBelow) return;

        var targetItem = elementBelow.closest('.sentence-item');

        // Ha tal√°ltunk m√°sik elemet, √©s nem √∂nmaga
        if (targetItem && targetItem !== activeItem && targetItem.parentNode === sentenceList) {
            
            // Poz√≠ci√≥k √∂sszehasonl√≠t√°sa a DOM-ban
            var allItems = Array.prototype.slice.call(sentenceList.children);
            var activeIndex = allItems.indexOf(activeItem);
            var targetIndex = allItems.indexOf(targetItem);

            if (activeIndex < targetIndex) {
                // Lefel√© mozgatjuk: a target ut√°n sz√∫rjuk be
                sentenceList.insertBefore(activeItem, targetItem.nextSibling);
            } else {
                // Felfel√© mozgatjuk: a target el√© sz√∫rjuk be
                sentenceList.insertBefore(activeItem, targetItem);
            }
        }
    }

    function handleEnd(e) {
        if (activeItem) {
            activeItem.classList.remove('dragging');
            activeItem = null;
        }
        
        // Takar√≠t√°s
        document.removeEventListener('mousemove', handleMouseMove, false);
        document.removeEventListener('mouseup', handleEnd, false);
    }


    // --- 3. EGY√âB FUNKCI√ìK (Kever√©s, Ment√©s) ---

    function shuffleSentences() {
        var ul = document.getElementById("sentence-list");
        for (var i = ul.children.length; i >= 0; i--) {
            ul.appendChild(ul.children[Math.random() * i | 0]);
        }
    }

    function confirmOrder() {
        if (sentenceList.children.length === 0 || sentenceList.children[0].textContent.indexOf("Options.txt") !== -1) {
            alert("El≈ëbb t√∂ltsd be az opci√≥kat a f√°jlb√≥l!");
            return;
        }

        var currentItems = sentenceList.children;
        
        for(var i=0; i<currentItems.length; i++) {
            var sentenceText = currentItems[i].textContent.trim();
            // Statisztika ment√©se
            if (preferenceStats[i]) {
                if (preferenceStats[i][sentenceText]) {
                    preferenceStats[i][sentenceText]++;
                } else {
                    preferenceStats[i][sentenceText] = 1;
                }
            }
        }

        confirmationCount++;
        counterValue.textContent = confirmationCount;

        resultMessage.style.display = 'block';
        resultMessage.innerHTML = '‚úÖ **R√∂gz√≠tve!** A te 1. preferenci√°d: <b>' + currentItems[0].textContent.trim() + '</b>';
        
        setTimeout(function() {
            resultMessage.style.display = 'none';
        }, 3000);
        
        shuffleSentences();
    }

    function calculateTotalScores() {
        var scores = {};
        
        for(var i=0; i<preferenceStats.length; i++) {
            var positionStats = preferenceStats[i];
            var pointsForPosition = 5 - i;
            
            for (var sentence in positionStats) {
                if (positionStats.hasOwnProperty(sentence)) {
                    var count = positionStats[sentence];
                    if (!scores[sentence]) scores[sentence] = 0;
                    scores[sentence] += (count * pointsForPosition);
                }
            }
        }

        var sortedScores = [];
        for (var text in scores) {
            if (scores.hasOwnProperty(text)) {
                sortedScores.push({ text: text, score: scores[text] });
            }
        }
        
        sortedScores.sort(function(a, b) {
            return b.score - a.score;
        });
        
        return sortedScores;
    }

    function showStatistics() {
        modalCounterValue.textContent = confirmationCount;
        
        var sortedScores = calculateTotalScores();
        scoreRankingContainer.innerHTML = '<h3>üèÜ Pontsz√°m alap√∫ rangsor (S√∫lyozott)</h3><p style="font-size:0.9em; color:#666;">(1. hely = 5p, ... 5. hely = 1p)</p>';
        
        if (sortedScores.length === 0) {
            scoreRankingContainer.innerHTML += '<p>M√©g nincs adat.</p>';
        } else {
            for(var k=0; k<sortedScores.length; k++) {
                var item = sortedScores[k];
                var div = document.createElement('div');
                div.className = 'score-item';
                div.innerHTML = '<span>' + item.text + '</span> <span class="score-badge">' + item.score + ' pont</span>';
                scoreRankingContainer.appendChild(div);
            }
        }

        var statsList = statisticsResults.querySelector('.stats-list');
        statsList.innerHTML = ''; 

        for(var i=0; i<preferenceStats.length; i++) {
            var positionStats = preferenceStats[i];
            var positionNumber = i + 1;
            
            var positionHeader = document.createElement('h3');
            positionHeader.textContent = positionNumber + '. helyen szerepelt:';
            statsList.appendChild(positionHeader);
            
            var sortedEntries = [];
            for (var key in positionStats) {
                if(positionStats.hasOwnProperty(key)) {
                    sortedEntries.push([key, positionStats[key]]);
                }
            }
            sortedEntries.sort(function(a, b) { return b[1] - a[1]; });
            
            var itemUl = document.createElement('ul');
            itemUl.style.listStyle = 'none';
            itemUl.style.paddingLeft = '0';

            if (sortedEntries.length > 0) {
                 for(var m=0; m<sortedEntries.length; m++) {
                    var entry = sortedEntries[m];
                    var listItem = document.createElement('li');
                    listItem.style.background = "#f4f7fa";
                    listItem.style.marginBottom = "4px";
                    listItem.style.padding = "5px";
                    listItem.innerHTML = entry[0] + ' ‚Äì <strong>' + entry[1] + '</strong> alkalommal';
                    itemUl.appendChild(listItem);
                }
            } else {
                 var emptyItem = document.createElement('li');
                 emptyItem.textContent = 'M√©g nem t√∂rt√©nt nyugt√°z√°s ezen a poz√≠ci√≥n.';
                 itemUl.appendChild(emptyItem);
            }
            statsList.appendChild(itemUl);
        }

        statisticsModal.style.display = 'block';
    }

    function saveStatisticsToFile() {
        var content = "STATISZTIKA EXPORT\r\n";
        content += "---------------------------------\r\n";
        content += "Datum: " + new Date().toLocaleString() + "\r\n";
        content += "Osszes kitoltes szama: " + confirmationCount + "\r\n";
        content += "---------------------------------\r\n\r\n";

        content += "üèÜ PONTSZAM ALAPU RANGSOR (Sulyozott)\r\n";
        content += "(Szamitas: 1. hely=5p, 2. hely=4p, 3. hely=3p, 4. hely=2p, 5. hely=1p)\r\n\r\n";
        
        var sortedScores = calculateTotalScores();
        if (sortedScores.length === 0) {
            content += "    (Nincs adat)\r\n";
        } else {
            for(var i=0; i<sortedScores.length; i++) {
                content += "    [" + sortedScores[i].score + " pont] - " + sortedScores[i].text + "\r\n";
            }
        }
        content += "\r\n---------------------------------\r\n\r\n";

        for(var j=0; j<preferenceStats.length; j++) {
            content += ">>> " + (j + 1) + ". HELYEZESEK:\r\n";
            var stats = preferenceStats[j];
            var entries = [];
            for(var key in stats) {
                if(stats.hasOwnProperty(key)) entries.push([key, stats[key]]);
            }
            entries.sort(function(a, b) { return b[1] - a[1]; });

            if (entries.length === 0) {
                content += "    (Nincs adat)\r\n";
            } else {
                for(var k=0; k<entries.length; k++) {
                    content += "    [" + entries[k][1] + " db] - " + entries[k][0] + "\r\n";
                }
            }
            content += "\r\n";
        }

        var now = new Date();
        // Egyszer≈±s√≠tett f√°jln√©v gener√°l√°s r√©gi b√∂ng√©sz≈ëkh√∂z
        var filename = "statisztika.txt";

        var blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        
        // IE10+ t√°mogat√°s
        if (window.navigator.msSaveOrOpenBlob) {
            window.navigator.msSaveOrOpenBlob(blob, filename);
        } else {
            var link = document.createElement("a");
            var url = URL.createObjectURL(blob);
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            setTimeout(function() {
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
            }, 0);
        }
    }

    function closeModal() { statisticsModal.style.display = 'none'; }
    window.onclick = function(event) { if (event.target == statisticsModal) closeModal(); }
</script>

</body>
</html>