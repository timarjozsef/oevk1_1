<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sorrend</title>
    <style>
        /* --- Alapvet≈ë St√≠lusok --- */
        body {
            font-family: 'Times New Roman', Georgia, serif;
            margin: 0;
            padding: 0;
            background-color: #f0f4f7;
            color: #333333;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #0E163D;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-row {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: justify;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .header-row > * { margin: 0 5px; }

        .logo-left { max-height: 80px; width: auto; }
        .logo-right { max-height: 140px; width: auto; }

        .header-text { 
            text-align: center; 
            -webkit-box-flex: 1; 
            -ms-flex-positive: 1; 
            flex-grow: 1; 
        }

        .candidate-label {
            font-size: 1.4rem;
            color: #ffffff;
            margin-bottom: 5px;
            font-family: Georgia, serif;
        }

        .candidate-name {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.2;
        }

        p { line-height: 1.5; margin-bottom: 15px; color: #ffffff;}
        
        /* --- F√°jl felt√∂lt√©s szekci√≥ --- */
        .file-upload-section {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border: 1px dashed #6c757d;
            text-align: center;
        }
        .file-upload-section label {
            font-weight: bold;
            color: #495057;
            cursor: pointer;
            display: block;
            padding: 10px;
            font-size: 1.1em;
        }
        #file-error-msg {
            color: #dc3545;
            font-size: 0.9em;
            display: none;
            margin-top: 5px;
        }
        
        /* --- √öJ STRUKT√öRA: Egyetlen lista kezeli a sz√°mot √©s a dobozt is --- */
        .ranking-wrapper {
            /* A flex layout innen t√∂r√∂lve, mert nem kell k√©t oszlop */
            display: block;
            margin-bottom: 20px;
        }

        /* A k√ºl√∂n√°ll√≥ sz√°m oszlopot t√∂r√∂lt√ºk CSS-b≈ël √©s HTML-b≈ël is */

        #sentence-list {
            list-style: none;
            padding: 0;
            margin: 0;
            counter-reset: rank-counter; /* CSS sz√°ml√°l√≥ ind√≠t√°sa */
        }

        .sentence-item {
            /* Ez most a sor kont√©nere (sz√°m + doboz) */
            display: flex;
            align-items: center; /* Ez k√∂z√©pre igaz√≠tja a sz√°mot f√ºgg≈ëlegesen! */
            margin-bottom: 8px;
            cursor: move;
            cursor: -webkit-grab;
            touch-action: none;
        }

        /* A sorsz√°m gener√°l√°sa CSS-sel */
        .sentence-item::before {
            counter-increment: rank-counter;
            content: counter(rank-counter) ".";
            color: #ffffff;
            font-weight: bold;
            font-size: 1.4em;
            width: 40px; /* Fix sz√©less√©g a sz√°mnak */
            flex-shrink: 0;
            text-align: center;
            margin-right: 5px;
        }

        /* A t√©nyleges sz√≠nes doboz st√≠lusa */
        .sentence-content {
            background-color: #88E8FF;
            padding: 15px 15px 15px 40px;
            border-left: 5px solid transparent; /* JS sz√≠nezi */
            border-radius: 4px;
            font-size: 1.05em;
            position: relative;
            min-height: 24px;
            flex-grow: 1; /* Kit√∂lti a marad√©k helyet */
            display: flex;
            align-items: center;
        }

        /* A hamburger ikon most a bels≈ë dobozhoz tartozik */
        .sentence-content::before {
            content: '‚ò∞';
            position: absolute;
            left: 10px;
            color: #88E8FF;
            /* S√∂t√©t√≠t√©s a l√°that√≥s√°g√©rt a vil√°gos h√°tt√©ren, vagy az eredeti sz√≠n */
            color: rgba(14, 22, 61, 0.5); 
            font-size: 1.2em;
            font-weight: bold;
        }

        .sentence-item.dragging {
            opacity: 0.8;
            z-index: 100;
        }
        
        /* Dragging k√∂zben a bels≈ë doboz st√≠lusa v√°ltozik */
        .sentence-item.dragging .sentence-content {
            background-color: #A3FFFD;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: scale(1.02);
        }

        .button-group {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            margin-top: 25px;
        }
        
        .button-group button {
            -webkit-box-flex: 1;
            -ms-flex-positive: 1;
            flex-grow: 1;
            padding: 15px 10px;
            border: 2px solid #ffffff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin: 0 5px;
        }
        
        .confirm-btn { background-color: #24B574; color: white; }
        .stats-btn { background-color: #0E163D; color: white; }

        .save-btn {
            background-color: #0056b3;
            color: white;
            padding: 12px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 15px;
            width: 100%;
            font-size: 1em;
        }

        #result-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        #counter-display {
            margin-top: 20px;
            padding: 10px;
            text-align: center;
			color: #ffffff;
            border: 1px solid #0E163D;
            border-radius: 4px;
            font-size: 1.1em;
            background-color: #0E163D;
        }
        
        #counter-value { font-weight: bold; color: #ffffff; font-size: 1.5em; }

        /* --- Mod√°lis ablak --- */
        #statistics-modal {
            position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); display: none;
        }
        .modal-content {
            background-color: #ffffff; margin: 5% auto; padding: 20px;
            border-radius: 8px; width: 90%; max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); max-height: 80vh; overflow-y: auto;
        }
        .close-btn { color: #aaa; float: right; font-size: 30px; font-weight: bold; cursor: pointer; padding: 0 10px; }
        
        .score-item {
            background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404;
            padding: 10px; margin-bottom: 5px; border-radius: 4px;
            display: -webkit-box; display: -ms-flexbox; display: flex;
            -webkit-box-pack: justify; -ms-flex-pack: justify; justify-content: space-between;
        }

        @media (max-width: 650px) {
            .container { margin: 10px auto; padding: 15px; }
            .button-group { display: block; }
            .button-group button { width: 100%; margin: 5px 0; }
            .header-row { display: block; text-align: center; }
            .header-row > * { margin: 10px 0; }
            .logo-left { max-height: 60px; }
            .logo-right { max-height: 100px; }
            /* number-column st√≠lusok t√∂r√∂lve, m√°r nem sz√ºks√©ges */
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-row">
        <img alt="Logo" src="Logo.png" class="logo-left">
        <div class="header-text">
            <div class="candidate-label">A Mi jel√∂lt√ºnk</div>
            <div class="candidate-name">Szeleczky Annam√°ria</div>
        </div>
        <img alt="Candidate" src="Candidate.png" class="logo-right">
    </div>

    <div id="upload-container" class="file-upload-section">
        <label for="options-file">üìÇ Ha nem t√∂lt≈ëd√∂tt be mag√°t√≥l, kattints ide az <b>Options.txt</b> bet√∂lt√©s√©hez!</label>
        <input type="file" id="options-file" accept=".txt" style="display: none;">
        <div id="file-error-msg"></div>
    </div>
	<div>
		<p>√Åll√≠tsa az al√°bbi probl√©m√°kat fontoss√°gi sorrendbe (legfel√ºl a legfontosabb). Fogja meg √©s h√∫zza √°t az elemeket!</p>
	</div>
    
    <div class="ranking-wrapper">
        <ul id="sentence-list">
            <li class="sentence-item">
                 <div class="sentence-content" style="border-left-color: #3282F6;">
                    K√©rlek t√∂ltsd be az Options.txt f√°jlt a fenti gombbal!
                 </div>
            </li>
        </ul>
    </div>

    <div class="button-group">
        <button class="confirm-btn" onclick="confirmOrder()">Sorrend nyugt√°z√°sa</button>
        <button class="stats-btn" onclick="showStatistics()">Statisztika megtekint√©se</button>
    </div>

    <div id="result-message"></div>
    
    <div id="counter-display">
        Nyugt√°z√°sok sz√°ma: <span id="counter-value">19</span>
    </div>
</div>

<div id="statistics-modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2>üìä √ñsszes√≠tett statisztika</h2>
        
        <button class="save-btn" onclick="saveStatisticsToFile()">üíæ Statisztika ment√©se f√°jlba</button>

        <p>Eddig elv√©gzett nyugt√°z√°sok: <span id="modal-counter-value">19</span></p>
        
        <div id="score-ranking-container"></div>
        <hr>
        <div id="statistics-results">
            <ul class="stats-list" style="list-style: none; padding: 0;"></ul>
        </div>
    </div>
</div>

<script>
    // --- V√°ltoz√≥k inicializ√°l√°sa ---
    var sentenceList = document.getElementById('sentence-list');
    var resultMessage = document.getElementById('result-message');
    var counterValue = document.getElementById('counter-value');
    var statisticsModal = document.getElementById('statistics-modal');
    var modalCounterValue = document.getElementById('modal-counter-value');
    var statisticsResults = document.getElementById('statistics-results');
    var scoreRankingContainer = document.getElementById('score-ranking-container');
    var fileInput = document.getElementById('options-file');
    var fileErrorMsg = document.getElementById('file-error-msg');
    var uploadContainer = document.getElementById('upload-container'); 
    
    var confirmationCount = 19;
    var lastConfirmationTime = 0;
    
    var preferenceStats = [];
    var dragSrcEl = null;
    
    // --- 1. OPCI√ìK BET√ñLT√âSE ---

    window.onload = function() {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'Options.txt', true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200 || xhr.status === 0) {
                    var text = xhr.responseText;
                    if (text && text.length > 0) {
                        fileErrorMsg.style.display = 'none';
                        processOptions(text);
                    }
                } else {
                    console.log("Automata bet√∂lt√©s hiba.");
                    fileErrorMsg.textContent = "Kattints a fenti gombra az Options.txt bet√∂lt√©s√©hez!";
                    fileErrorMsg.style.display = 'block';
                }
            }
        };
        try { xhr.send(); } catch(e) { 
            console.log(e); 
            fileErrorMsg.textContent = "Kattints a fenti gombra az Options.txt bet√∂lt√©s√©hez!";
            fileErrorMsg.style.display = 'block';
        }
    };

    fileInput.addEventListener('change', function(e) {
        var file = e.target.files[0];
        if (!file) return;

        var reader = new FileReader();
        reader.onload = function(e) {
            processOptions(e.target.result);
            fileErrorMsg.style.display = 'none'; 
        };
        reader.readAsText(file, "UTF-8"); 
    });

    function processOptions(text) {
        var lines = text.replace(/\r\n/g, "\n").split("\n");
        var cleanLines = [];
        for(var k=0; k<lines.length; k++) {
            if(lines[k].trim() !== "") cleanLines.push(lines[k]);
        }
        cleanLines = cleanLines.slice(0, 5); 

        if (cleanLines.length === 0) {
            alert("A f√°jl √ºres vagy nem olvashat√≥!");
            return;
        }

        var borderColors = [
            "#3282F6", 
            "#E02424", 
            "#16C60C", 
            "#F29F05", 
            "#9B59B6" 
        ];

        // Lista t√∂rl√©se √©s √∫jra√©p√≠t√©se
        sentenceList.innerHTML = '';
        
        // M√ìDOS√çT√ÅS: √öj strukt√∫ra gener√°l√°sa (Flexboxos elrendez√©shez)
        for(var i=0; i<cleanLines.length; i++) {
            // A k√ºls≈ë kont√©ner (ez lesz a "sor", amiben a sz√°m is van)
            var li = document.createElement('li');
            li.className = 'sentence-item';
            
            // A bels≈ë doboz (ez a sz√≠nes, sz√∂veges r√©sz)
            var contentDiv = document.createElement('div');
            contentDiv.className = 'sentence-content';
            contentDiv.textContent = cleanLines[i].trim();

            // Sz√≠n hozz√°rendel√©se a bels≈ë dobozhoz
            if(borderColors[i]) {
                contentDiv.style.borderLeftColor = borderColors[i];
            } else {
                contentDiv.style.borderLeftColor = "#333";
            }

            li.appendChild(contentDiv);
            sentenceList.appendChild(li);
        }

        // A numberColumn gener√°l√°s T√ñR√ñLVE, mert CSS Counter oldja meg.

        initializeStats(cleanLines.length);
        addDragEvents();

        if (uploadContainer) {
            uploadContainer.style.display = 'none';
        }
    }

    function initializeStats(count) {
        preferenceStats = [];
        for (var i = 0; i < count; i++) {
            preferenceStats.push({});
        }
    }

    // --- 2. DRAG & DROP ---
    
    function addDragEvents() {
        var items = document.querySelectorAll('.sentence-item');
        for (var i = 0; i < items.length; i++) {
            var item = items[i];
            item.addEventListener('mousedown', handleStart, false);
            item.addEventListener('touchstart', handleStart, false);
            item.addEventListener('touchmove', handleMove, { passive: false });
            item.addEventListener('touchend', handleEnd, false);
        }
    }

    var activeItem = null;
    var startY = 0;
    var startX = 0;

    function handleStart(e) {
        if (e.type === 'mousedown' && e.button !== 0) return;

        // A teljes sort mozgatjuk (.sentence-item)
        activeItem = this.closest('.sentence-item');
        if (!activeItem) return;

        activeItem.classList.add('dragging');
        
        if (e.type === 'touchstart') {
            var touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
        } 
        
        if (e.type === 'mousedown') {
            document.addEventListener('mousemove', handleMouseMove, false);
            document.addEventListener('mouseup', handleEnd, false);
        }
    }

    function handleMouseMove(e) {
        e.preventDefault();
        checkSwap(e.clientX, e.clientY);
    }

    function handleMove(e) {
        if (!activeItem) return;
        if (e.cancelable) e.preventDefault(); 
        var touch = e.touches[0];
        checkSwap(touch.clientX, touch.clientY);
    }

    function checkSwap(x, y) {
        if (!activeItem) return;

        // Elrejtj√ºk, hogy l√°ssuk mi van alatta
        var originalDisplay = activeItem.style.display;
        activeItem.style.display = 'none'; 
        
        var elementBelow = document.elementFromPoint(x, y);
        
        activeItem.style.display = originalDisplay; 

        if (!elementBelow) return;

        var targetItem = elementBelow.closest('.sentence-item');

        if (targetItem && targetItem !== activeItem && targetItem.parentNode === sentenceList) {
            var allItems = Array.prototype.slice.call(sentenceList.children);
            var activeIndex = allItems.indexOf(activeItem);
            var targetIndex = allItems.indexOf(targetItem);

            if (activeIndex < targetIndex) {
                sentenceList.insertBefore(activeItem, targetItem.nextSibling);
            } else {
                sentenceList.insertBefore(activeItem, targetItem);
            }
        }
    }

    function handleEnd(e) {
        if (activeItem) {
            activeItem.classList.remove('dragging');
            activeItem = null;
        }
        document.removeEventListener('mousemove', handleMouseMove, false);
        document.removeEventListener('mouseup', handleEnd, false);
    }

    // --- 3. EGY√âB FUNKCI√ìK ---

    function shuffleSentences() {
        var ul = document.getElementById("sentence-list");
        for (var i = ul.children.length; i >= 0; i--) {
            ul.appendChild(ul.children[Math.random() * i | 0]);
        }
    }

    function confirmOrder() {
        if (sentenceList.children.length === 0 || sentenceList.textContent.indexOf("Options.txt") !== -1) {
            alert("El≈ëbb t√∂ltsd be az opci√≥kat a f√°jlb√≥l!");
            return;
        }

        var now = new Date().getTime();
        var timeDiff = now - lastConfirmationTime;
        var requiredDelay = 10000; 

        if (timeDiff < requiredDelay) {
            var remaining = Math.ceil((requiredDelay - timeDiff) / 1000);
            resultMessage.style.display = 'block';
            resultMessage.style.backgroundColor = '#f8d7da'; 
            resultMessage.style.color = '#721c24'; 
            resultMessage.innerHTML = '‚ö†Ô∏è K√©rlek v√°rj m√©g <b>' + remaining + '</b> m√°sodpercet a k√∂vetkez≈ë r√∂gz√≠t√©sig!';
            setTimeout(function() {
                resultMessage.style.display = 'none';
            }, 2000);
            return; 
        }
        
        lastConfirmationTime = now;

        var currentItems = sentenceList.children;
        for(var i=0; i<currentItems.length; i++) {
            // M√≥dos√≠t√°s: a sz√∂veg most a .sentence-content div-ben van
            var contentDiv = currentItems[i].querySelector('.sentence-content');
            var sentenceText = contentDiv ? contentDiv.textContent.trim() : "";
            
            if (preferenceStats[i]) {
                if (preferenceStats[i][sentenceText]) {
                    preferenceStats[i][sentenceText]++;
                } else {
                    preferenceStats[i][sentenceText] = 1;
                }
            }
        }

        confirmationCount++;
        counterValue.textContent = confirmationCount;

        resultMessage.style.display = 'block';
        resultMessage.style.backgroundColor = '#d4edda';
        resultMessage.style.color = '#155724';
        
        var firstItemText = currentItems[0].querySelector('.sentence-content').textContent.trim();
        resultMessage.innerHTML = '‚úÖ **R√∂gz√≠tve!** A te 1. preferenci√°d: <b>' + firstItemText + '</b>';
        
        setTimeout(function() {
            resultMessage.style.display = 'none';
        }, 3000);
        
        shuffleSentences();
    }

    function calculateTotalScores() {
        var scores = {};
        for(var i=0; i<preferenceStats.length; i++) {
            var positionStats = preferenceStats[i];
            var pointsForPosition = 5 - i;
            for (var sentence in positionStats) {
                if (positionStats.hasOwnProperty(sentence)) {
                    var count = positionStats[sentence];
                    if (!scores[sentence]) scores[sentence] = 0;
                    scores[sentence] += (count * pointsForPosition);
                }
            }
        }
        var sortedScores = [];
        for (var text in scores) {
            if (scores.hasOwnProperty(text)) {
                sortedScores.push({ text: text, score: scores[text] });
            }
        }
        sortedScores.sort(function(a, b) { return b.score - a.score; });
        return sortedScores;
    }

    function showStatistics() {
        modalCounterValue.textContent = confirmationCount;
        var sortedScores = calculateTotalScores();
        scoreRankingContainer.innerHTML = '<h3>üèÜ Pontsz√°m alap√∫ rangsor (S√∫lyozott)</h3><p style="font-size:0.9em; color:#666;">(1. hely = 5p, ... 5. hely = 1p)</p>';
        
        if (sortedScores.length === 0) {
            scoreRankingContainer.innerHTML += '<p>M√©g nincs adat.</p>';
        } else {
            for(var k=0; k<sortedScores.length; k++) {
                var item = sortedScores[k];
                var div = document.createElement('div');
                div.className = 'score-item';
                div.innerHTML = '<span>' + item.text + '</span> <span class="score-badge">' + item.score + ' pont</span>';
                scoreRankingContainer.appendChild(div);
            }
        }

        var statsList = statisticsResults.querySelector('.stats-list');
        statsList.innerHTML = ''; 

        for(var i=0; i<preferenceStats.length; i++) {
            var positionStats = preferenceStats[i];
            var positionNumber = i + 1;
            var positionHeader = document.createElement('h3');
            positionHeader.textContent = positionNumber + '. helyen szerepelt:';
            statsList.appendChild(positionHeader);
            
            var sortedEntries = [];
            for (var key in positionStats) {
                if(positionStats.hasOwnProperty(key)) {
                    sortedEntries.push([key, positionStats[key]]);
                }
            }
            sortedEntries.sort(function(a, b) { return b[1] - a[1]; });
            
            var itemUl = document.createElement('ul');
            itemUl.style.listStyle = 'none';
            itemUl.style.paddingLeft = '0';

            if (sortedEntries.length > 0) {
                 for(var m=0; m<sortedEntries.length; m++) {
                    var entry = sortedEntries[m];
                    var listItem = document.createElement('li');
                    listItem.style.background = "#f4f7fa";
                    listItem.style.marginBottom = "4px";
                    listItem.style.padding = "5px";
                    listItem.innerHTML = entry[0] + ' ‚Äì <strong>' + entry[1] + '</strong> alkalommal';
                    itemUl.appendChild(listItem);
                }
            } else {
                 var emptyItem = document.createElement('li');
                 emptyItem.textContent = 'M√©g nem t√∂rt√©nt nyugt√°z√°s ezen a poz√≠ci√≥n.';
                 itemUl.appendChild(emptyItem);
            }
            statsList.appendChild(itemUl);
        }
        statisticsModal.style.display = 'block';
    }

    function saveStatisticsToFile() {
        var content = "STATISZTIKA EXPORT\r\n";
        content += "---------------------------------\r\n";
        content += "Datum: " + new Date().toLocaleString() + "\r\n";
        content += "Osszes kitoltes szama: " + confirmationCount + "\r\n";
        content += "---------------------------------\r\n\r\n";

        content += "üèÜ PONTSZAM ALAPU RANGSOR (Sulyozott)\r\n";
        
        var sortedScores = calculateTotalScores();
        if (sortedScores.length === 0) {
            content += "    (Nincs adat)\r\n";
        } else {
            for(var i=0; i<sortedScores.length; i++) {
                content += "    [" + sortedScores[i].score + " pont] - " + sortedScores[i].text + "\r\n";
            }
        }
        content += "\r\n---------------------------------\r\n\r\n";

        for(var j=0; j<preferenceStats.length; j++) {
            content += ">>> " + (j + 1) + ". HELYEZESEK:\r\n";
            var stats = preferenceStats[j];
            var entries = [];
            for(var key in stats) {
                if(stats.hasOwnProperty(key)) entries.push([key, stats[key]]);
            }
            entries.sort(function(a, b) { return b[1] - a[1]; });

            if (entries.length === 0) {
                content += "    (Nincs adat)\r\n";
            } else {
                for(var k=0; k<entries.length; k++) {
                    content += "    [" + entries[k][1] + " db] - " + entries[k][0] + "\r\n";
                }
            }
            content += "\r\n";
        }

        var now = new Date();
        var filename = "statisztika.txt";
        var blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        
        if (window.navigator.msSaveOrOpenBlob) {
            window.navigator.msSaveOrOpenBlob(blob, filename);
        } else {
            var link = document.createElement("a");
            var url = URL.createObjectURL(blob);
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            setTimeout(function() {
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
            }, 0);
        }
    }

    function closeModal() { statisticsModal.style.display = 'none'; }
    window.onclick = function(event) { if (event.target == statisticsModal) closeModal(); }
</script>

</body>
</html>